\chapter{Design}
% input Design sections for no auto new page
This chapter describes the design of a MIPS 1 microcontroller. A microcontroller consists mostly of a processor core, memory and programmable inputs/outputs peripherals. 
This design implementation focus only on the processor core design.

This laboratory requires a microcontroller structure of at least a CPU containing a controlpath, datapath and an ALU. The created design uses this base with a 5-staged pipeline.
The CPU interacts with two external memories and has also a clock and a reset input. All of which are considered external to this design.
The CPU is divided in two base components: a control and a datapath block, as shown  in \autoref{fig:overview}.



\begin{figure}[h!]
  \centering
  \includegraphics[width=0.8\textwidth]{figure/overview.png}
  \caption{Datapath pipeline}
  \label{fig:overview}
\end{figure}


In the datapath there is the pipeline made of five blocks: instruction fetch (IF), instruction decode (ID), execution (EX), memory stage (Me) and writeback (WB).

The following sections describe the central component ALU and the two base components: datapath and controlpath.
The cpu components structure is shown in \autoref{fig:cpu structure}:
\begin{figure}[h!]
\begin{center}
 \tikzstyle{every node}=[draw=black,thick,anchor=west]
\tikzstyle{selected}=[draw=red,fill=red!30]
\tikzstyle{optional}=[dashed,fill=gray!50]
\begin{tikzpicture}[%
  grow via three points={one child at (0.5,-0.7) and
  two children at (0.5,-0.7) and (0.5,-1.4)},
  edge from parent path={(\tikzparentnode.south) |- (\tikzchildnode.west)}]
  \node {cpu}
    child { node {controlpath}}		
    child { node {datapath}
      child { node {Instruction Fetch}}
      child { node {Instruction Decode}}      
      child { node  {Execution}
	%child { node {ALU}}
	}
      child { node {Memory Stage}}
      child { node {Writeback}}
    };
\end{tikzpicture}
\caption{CPU component structure}
\label{fig:cpu structure}
\end{center}
\end{figure}

	\input{ALU}
	\input{Datapath}
	\input{Controlpath}
	